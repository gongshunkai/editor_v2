/*
 editor.js 2.0

 Author: 龚顺凯 49078111@qq.com
 Update: 2018-11-6

*/
(function(C){var l=function(){var a,b,c;return{save:function(d){window.getSelection?(a=window.getSelection(),b=a.rangeCount&&a.getRangeAt(0)):document.selection&&(a=document.selection.createRange());c=d},pasteHTML:function(d){a.pasteHTML?a.pasteHTML(d):b.insertNode($(d).get(0))},htmlText:function(){return a.htmlText||a.text||a.toString()},reselect:function(){a.moveStart?(a.moveStart("character",0),a.select()):b&&(a.removeAllRanges(),a.addRange(b))},selectNode:function(d){a.moveToElementText?(a.moveToElementText(d),
a.select()):(b&&(a.removeAllRanges(),a.addRange(b)),b.selectNodeContents(d))},anchorNode:function(){return a.anchorNode},parentElement:function(d){return!d&&c?c:a.parentElement?a.parentElement():a.anchorNode?a.anchorNode.parentNode:document.createElement("div")}}}(),v=function(a){a.attachEvent?a.attachEvent("oncontrolselect",function(a){a.returnValue=!1}):a.addEventListener("mscontrolselect",function(a){a.preventDefault()})},y=function(){var a=!1;return function(b){w.isIE()?b.find("img,table").each(function(){v($(this).get(0))}):
a||(a=!0,document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1))}}(),z=function(a){10>a.html().length&&!a.find("p").length&&(w.isIE()||(w.isFF()?document.execCommand("insertParagraph",!1):a.append("<p><br></p>")))},D=function(a,b){var c=[],d={},e=[],g=function(b){if(b.get&&b.get(0)){var k=b.get(0).tagName,g=b.get(0).attributes;c.push(k);e.push(b);for(var q in g){k=g[q]||{};for(var u in a.attributes)k.name!==u||d[u]||(d[u]=k.value)}}return b},k=l.parentElement();
g($(k)).parentsUntil(b||"body").each(function(){g($(this))});return{tagNames:c,attributes:d,elements:e}},w=function(){var a=null,b=!1,c=!1,d=!1,e=!1,g=!1;try{a=navigator.userAgent.toLowerCase(),-1!=a.indexOf("msie")||-1!=a.indexOf("rv:11")?b=!0:-1!=a.indexOf("firefox")?c=!0:-1!=a.indexOf("opera")?d=!0:-1!=a.indexOf("chrome")?g=!0:-1!=a.indexOf("safari")&&(e=!0)}catch(k){}return{isIE:function(){return b},isFF:function(){return c},isOpera:function(){return d},isChrome:function(){return g},isSafari:function(){return e}}}(),
r=function(){return(new Date).getTime()};String.prototype.camelCase=String.prototype.camelCase||function(){return this.replace(/-([a-z])/ig,function(a,b){return b.toUpperCase()})};String.prototype.underlineName=String.prototype.underlineName||function(){return this.replace(/([A-Z])/g,"-$1").toLowerCase()};var h={clients:[],on:function(a,b){this.clients[a]||(this.clients[a]=[]);this.clients[a].push(b);return this},fire:function(){var a=[].shift.call(arguments);a=this.clients[a];if(!a||0===a.length)return this;
for(var b=0,c;c=a[b++];)c.apply(this,arguments);return this},off:function(a,b){a=this.clients[a];if(!a)return this;if(b)for(var c=a.length-1;0<=c;c--)a[c]===b&&a.splice(c,1);else a&&(a.length=0);return this}};h.on("display.dialog",function(){this.target.attr("tabIndex","-1")});h.on("display.dialog",function(){this.opts.speed=this.opts.show?0:"slow"});h.on("display.dialog",function(){this.size(this.opts.width,this.opts.height)});h.on("display.dialog",function(){this.opts.absolute&&this.position(this.opts.left,
this.opts.top)});h.on("display.dialog",function(){this.opts.absolute&&this.target.css("position","absolute")});h.on("display.dialog",function(){this.opts.keyEsc&&this._addEscBehaviour()});h.on("display.dialog",function(){this.opts.skinClassName&&this.target.addClass(this.opts.skinClassName)});h.on("display.dialog",function(){this.opts.hideToolbar&&this._hideHeader()});h.on("display.dialog",function(){this.opts.hideContent&&this._hideBody()});h.on("show.dialog",function(){this.opts.onShow&&this.opts.onShow()});
h.on("shown.dialog",function(){this.opts.onShown&&this.opts.onShown()});h.on("hide.dialog",function(){this.opts.onHide&&this.opts.onHide()});h.on("hiden.dialog",function(){this.opts.onHiden&&this.opts.onHiden()});var A=function(){var a=[],b;return function(c){c=c||{};b=a[c.id];return b||(b=new p(c)),c.id&&(a[c.id]=b),b}}(),p=function(){this.init.apply(this,arguments)};$.extend(p.prototype,h,{init:function(a){this.opts=$.extend({},p.defaults,a);this.clients=$.extend(!0,{},h.clients);this.buttons=[]},
show:function(a){a=$.extend({},a);this.opts.draw?(this.opts.reload&&this._loadContents(a.contents),setTimeout(function(){this.fire("show.dialog");this.target.fadeIn(this.opts.speed,function(){this.fire("shown.dialog")}.bind(this))}.bind(this),100)):this._show(a)},_show:function(a){this.opts.draw=!0;this.opts.id=this.opts.id||p.getTimeTick();a=this._drawWindow(a);this._injectAllButtons();this.position();this.fire("display.dialog");a()},hide:function(){this.target.is(":visible")&&(this.fire("hide.dialog"),
this.target.fadeOut(this.opts.speed,function(){this.fire("hiden.dialog");"close"==this.opts.closeType&&this._hide()}.bind(this)))},_hide:function(){this.fire("hide.dialog");this.destory()},destory:function(){this.fire("destory.dialog");this.target.remove();this.buttons=this.clients=[]},position:function(a,b){void 0==a?a=this.target.position().left:(this.opts.left=a,this.target.css("left",this.opts.left));void 0==b?b=this.target.position().top:(this.opts.top=b,this.target.css("top",this.opts.top));
return{x:a,y:b}},size:function(a,b){void 0==a?a=this.target.width():(this.opts.width=a,this.target.outerWidth(this.opts.width));void 0==b?b=this.target.height():(this.opts.height=b,this.opts.fullHeight?this.target.outerHeight(this.opts.height):this.target.find(".editor-content").outerHeight(this.opts.height));return{w:a,h:b}},addButton:function(a){this.buttons.push(a);return this},_drawWindow:function(a){var b=this,c=this._template(this.opts.template,{_CONTENTS_:a.contents?a.contents.toString():""});
this.target=$(c);this._loadContents(a.contents);if(this.opts.clickBoxClose)$(this.opts.clickBoxClose).on("click",this.hide.bind(this)).on("keyup",function(a){37!=a.keyCode&&38!=a.keyCode&&39!=a.keyCode&&40!=a.keyCode&&13!=a.keyCode||this.hide()}.bind(this));return function(){$(b.opts.appendTo)[b.opts.appendMode](b.target);b.fire("show.dialog");b.target.fadeIn(b.opts.speed,function(){b.fire("shown.dialog")})}},_loadContents:function(a){a&&a.jquery?this.target.find(".editor-content").empty().append(a):
"function"===typeof a&&a(this.target.find(".editor-content").empty())},_hideHeader:function(){this.target.find(".toolbar").hide()},_hideBody:function(){this.target.find(".editor-content").hide()},_injectAllButtons:function(){this.buttons.forEach(function(a){this.target.find(".toolbar ul.list-inline").append(a)},this)},_addEscBehaviour:function(){this.opts.keyEsc&&(this.removeFn=function(a){27==a.keyCode&&this.hide()}.bind(this),this.target.on("keydown",this.removeFn))},_template:function(a,b){for(var c in b)a=
a.replace(new RegExp("{"+c+"}","g"),b[c]);return a}});p.getTimeTick=function(){return(new Date).getTime()};p.defaults={width:600,height:400,fullHeight:!0,appendTo:document.body,appendMode:"append",clickBoxClose:null,closeType:"close",reload:!1,absolute:!0,left:0,top:0,hideToolbar:!1,hideContent:!1,skinClassName:null,keyEsc:!0,show:!1,onShow:null,onShown:null,onHide:null,onHidden:null,template:'<div class="editor-wrap">\r\n    \t<div class="toolbar">\r\n    \t\t<ul class="list-inline" unselectable="on" onselectstart="return false"></ul>\r\n    \t</div>\r\n        <div class="editor-content">{_CONTENTS_}</div>\r\n    </div>'};
var x=function(){this.init.apply(this,arguments)};$.extend(x.prototype,{init:function(a){this.mediator=a;this.buttons=[]},injectCommand:function(){var a=this.mediator,b=this.buttons,c=[].shift.call(arguments),d=[].slice.call(arguments),e=a.opts.plugins[c];if(e){e.nodeInfo&&e.nodeInfo.attributes&&e.nodeInfo.attributes.forEach(function(d){a.nodeInfo.attributes[d]=1});var g=e.toolbarButtonCommand||function(){},k=new ("function"===typeof e.pluginFactoryCommand?e.pluginFactoryCommand(a):function(){});
e.dialog&&$.extend(k,{repos:function(){var d=this.node.position().left,b=this.node.position().top+this.node.height()-a.editable.scrollTop();this.dialog.position(d,b)}});a.plugins[c]=$.extend(k,{target:b[b.length-1]});g.apply(e,[a,c].concat(d))}},addButton:function(a){var b=this.mediator,c=this.buttons,d=b.opts.plugins[a];if(d){var e="function"===typeof d.toolbarButtonData?d.toolbarButtonData(b):d.toolbarButtonData;b=e instanceof jQuery?e:function(){var d=$('<li title="'+e.title+'"><button type="button" unselectable="on" onselectstart="return false" class="btn btn-default"'+
(e.commandName?' data-command-name="'+e.commandName.underlineName()+'"':"")+'><i class="'+e.icon+'"></i></button></li>');if(e.menu){var b=$('<ul class="dropdown-menu '+a.underlineName()+'-list"></ul>');e.menu.forEach(function(a){b.append('<li><a href="javascript:;"'+(a.valueArgument?' data-value-argument="'+a.valueArgument+'"':"")+">"+a.nodeText+"</a></li>")});d.addClass("dropdown").append(b).find("button").on("click",function(a){a.stopPropagation();a=$(this).parent();a.siblings().each(function(){$(this).hasClass("open")&&
$(this).removeClass("open")});a.toggleClass("open")})}return d}();c.push(b)}},addEscBehaviour:function(){function a(){c.forEach(function(a){a.hasClass("dropdown")&&a.hasClass("open")&&a.removeClass("open")})}var b=this.mediator.editwrap,c=this.buttons;b.on("click",a);b.on("keydown",function(d){27==d.keyCode&&a()})},destroy:function(){this.buttons.length=0}});var m=C.Editor=function(a,b){function c(){this.target="string"===typeof a?$("#"+a):a;p(this)}var d,e,g,k,q,t=new m.Mediator,h=r(),p=function(a){var c=
$.extend({},m.defaults,b);if("string"===typeof c.toolbarButtons){if("full"===c.toolbarButtons)for(var u in c.plugins)B.full.push(u);c.toolbarButtons=B[c.toolbarButtons]||[]}c.plugins=$.extend({},c.plugins,f);g=$('<div class="editor-table" contenteditable="true"></div>');k=$('<textarea class="code-table"></textarea>');g.on("input blur keyup paste copy cut mouseup",function(){a.trigger("valuechanged")}).on("click",function(a){t.userSelectionCommand(a.target)}).on("keyup",function(a){37!=a.keyCode&&
38!=a.keyCode&&39!=a.keyCode&&40!=a.keyCode&&13!=a.keyCode||t.userSelectionCommand()});k.on("change input propertychange",function(){a.setSource($(this).val())});e=new x(t);$.extend(t,{uniqid:h,editor:a,target:a.target,opts:c,plugins:{},nodeInfo:{tags:{},attributes:{}},codable:k,editable:g,userSelectionCommand:function(a){l.save(a);var c=this,b=D(this.nodeInfo,d);this.opts.toolbarButtons.forEach(function(a){var d=c.opts.plugins[a];if(d){var e=d.userSelectionCommand||function(){};if(d.nodeInfo&&d.nodeInfo.tags){var k=
0,g=0;for(d=d.nodeInfo.tags;k<d.length;k++)if(0<=(g=b.tagNames.indexOf(d[k]))){e(c,b.elements[g],a);break}else e(c,null,a)}else d.nodeInfo&&d.nodeInfo.attributes?e(c,b.attributes[d.nodeInfo.attributes[0]],a):e(c,b,a)}})},selectInEditor:function(){var a=l.parentElement();a=$(a).parents(".editor-wrap").data("uniqid");return h===a},execCommand:function(a,d,c){this.selectInEditor()&&document.execCommand(a,d,c)},pasteHTML:function(a){this.selectInEditor()&&l.pasteHTML(a)}});a.on("initialized",function(){d=
q.target;d.data("uniqid",h);$.extend(t,{editwrap:d});e.addEscBehaviour();g.focus();l.save();z(g);a.on("valuechanged",function(){l.save();z(g)});y(g)});c.toolbarButtons.forEach(function(a){e.addButton(a);e.injectCommand(a)});q=new A({width:"100%",height:c.height,fullHeight:!1,appendTo:a.target,appendMode:"after",absolute:!1,keyEsc:!1,skinClassName:c.skinClassName,onShown:function(){a.trigger("initialized")}});e.buttons.forEach(function(a){q.addButton(a)});q.show({contents:function(a){a.append(g);a.append(k)}});
a.target.addClass("hide")};c.prototype={on:function(){this.target.on.apply(this.target,arguments)},off:function(){this.target.off.apply(this.target,arguments)},trigger:function(){this.target.trigger.apply(this.target,arguments)},getSource:function(){return g.html()},setSource:function(a){g.html(a);this.trigger("valuechanged")},toggleFullScreen:function(a){!0===a?($(document.documentElement).addClass("full-fix"),ditwrap.addClass("full-fix")):($(document.documentElement).toggleClass("full-fix"),d.toggleClass("full-fix"))},
showSource:function(){d.addClass("source-mode");k.val(this.getSource());e.buttons.forEach(function(a){(a=a.find("button"))&&"full-screen"!==a.attr("data-command-name")&&"code-view"!==a.attr("data-command-name")&&a.attr("disabled","disabled")})},hideSource:function(){d.removeClass("source-mode");this.setSource(k.val());y(g);e.buttons.forEach(function(a){(a=a.find("button"))&&"full-screen"!==a.attr("data-command-name")&&"code-view"!==a.attr("data-command-name")&&a.removeAttr("disabled")})},hasSource:function(){return d.hasClass("source-mode")},
toggleSource:function(a){this.hasSource()&&!0!==a?this.hideSource():this.showSource()},destroy:function(){e.destroy();q.destory();t=null;this.target.removeClass("hide").off("initialized").off("valuechanged")}};return new c};m.defaults={height:200,toolbarButtons:[],skinClassName:null,plugins:{},defaultImage:"images/image.png",loadingImage:"images/loading.gif",upload:!1};m.Mediator=function(){};m.dialog=function(a){return new A(a)};m.toolbar=function(a){return new x(a)};var B={full:"bold italic underline strikeThrough fontFamily fontSize formatBlock color align orderedList unorderedList quote indent outdent table link image video insertHR selectAll removeFormat undo redo fullScreen help codeView".split(" "),
simple:"bold italic underline strikeThrough fontFamily fontSize align orderedList unorderedList link image undo redo help".split(" "),mini:"bold italic underline align link image undo redo".split(" ")},f={};$.extend(f,{fontFamily:{nodeInfo:{attributes:["face"]},toolbarButtonData:{icon:"fa fa-font",title:"\u5b57\u4f53",commandName:"fontName",menu:[{valueArgument:"SimSun",nodeText:'<span style="font-family:SimSun">\u5b8b\u4f53</span>'},{valueArgument:"FangSong_GB2312",nodeText:'<span style="font-family:FangSong_GB2312">\u4eff\u5b8b\u4f53</span>'},
{valueArgument:"SimHei",nodeText:'<span style="font-family:SimHei">\u9ed1\u4f53</span>'},{valueArgument:"KaiTi_GB2312",nodeText:'<span style="font-family:KaiTi_GB2312">\u6977\u4f53</span>'},{valueArgument:"Microsoft YaHei",nodeText:'<span style="font-family:Microsoft YaHei">\u5fae\u8f6f\u96c5\u9ed1</span>'},{valueArgument:"Arial",nodeText:'<span style="font-family:Arial">Arial</span>'},{valueArgument:"Georgia",nodeText:'<span style="font-family:Georgia">Georgia</span>'},{valueArgument:"Impact",nodeText:'<span style="font-family:Impact">Impact</span>'},
{valueArgument:"Tahoma",nodeText:'<span style="font-family:Tahoma">Tahoma</span>'},{valueArgument:"Times New Roman",nodeText:'<span style="font-family:Times New Roman">Times New Roman</span>'},{valueArgument:"Verdana",nodeText:'<span style="font-family:Verdana">Verdana</span>'}]}},fontSize:{nodeInfo:{attributes:["size"]},toolbarButtonData:{icon:"fa fa-text-height",title:"\u5b57\u4f53\u5927\u5c0f",commandName:"fontSize",menu:[{valueArgument:"5",nodeText:"\u8d85\u5927\u5b57\u4f53"},{valueArgument:"4",
nodeText:"\u5927\u53f7\u5b57\u4f53"},{valueArgument:"3",nodeText:"\u6b63\u5e38\u5927\u5c0f"},{valueArgument:"2",nodeText:"\u5c0f\u53f7\u5b57\u4f53"},{valueArgument:"1",nodeText:"\u8d85\u5c0f\u5b57\u4f53"}]}},formatBlock:{toolbarButtonData:{icon:"fa fa-paragraph",title:"\u6bb5\u843d\u6807\u7b7e",commandName:"formatBlock",menu:[{valueArgument:"<H1>",nodeText:"<h1>\u6807\u98981</h1>"},{valueArgument:"<H2>",nodeText:"<h2>\u6807\u98981</h2>"},{valueArgument:"<H3>",nodeText:"<h3>\u6807\u98981</h3>"},{valueArgument:"<H4>",
nodeText:"<h4>\u6807\u98981</h4>"},{valueArgument:"<H5>",nodeText:"<h5>\u6807\u98981</h5>"},{valueArgument:"<H6>",nodeText:"<h6>\u6807\u98981</h6>"}]},userSelectionCommand:function(a,b){a.plugins.formatBlock.target.find("ul.dropdown-menu li").each(function(){var a=$(this).find("a").attr("data-value-argument");0<=b.tagNames.indexOf(a.replace("<","").replace(">",""))?$(this).addClass("active"):$(this).removeClass("active")})}},color:{nodeInfo:{attributes:["color"]},toolbarButtonData:{icon:"fa fa-tint",
title:"\u989c\u8272",commandName:"foreColor",menu:[{valueArgument:"#e33737",nodeText:'<span style="background:#e33737"></span>'},{valueArgument:"#e28b41",nodeText:'<span style="background:#e28b41"></span>'},{valueArgument:"#c8a732",nodeText:'<span style="background:#c8a732"></span>'},{valueArgument:"#209361",nodeText:'<span style="background:#209361"></span>'},{valueArgument:"#418caf",nodeText:'<span style="background:#418caf"></span>'},{valueArgument:"#aa8773",nodeText:'<span style="background:#aa8773"></span>'},
{valueArgument:"#999999",nodeText:'<span style="background:#999999"></span>'},{valueArgument:"#000000",nodeText:'<span style="background:#000000"></span>'}]}},bold:{nodeInfo:{tags:["B","STRONG"]},toolbarButtonData:{icon:"fa fa-bold",title:"\u52a0\u7c97",commandName:"bold"}},italic:{nodeInfo:{tags:["I","EM"]},toolbarButtonData:{icon:"fa fa-italic",title:"\u659c\u4f53",commandName:"italic"}},underline:{nodeInfo:{tags:["U"]},toolbarButtonData:{icon:"fa fa-underline",title:"\u4e0b\u5212\u7ebf",commandName:"underline"}},
strikeThrough:{nodeInfo:{tags:["STRIKE"]},toolbarButtonData:{icon:"fa fa-strikethrough",title:"\u5220\u9664\u7ebf",commandName:"strikeThrough"}},insertHR:{toolbarButtonData:{icon:"fa fa-minus",title:"\u6c34\u5e73\u7ebf",commandName:"insertHorizontalRule"}},selectAll:{toolbarButtonData:{icon:"fa fa-mouse-pointer",title:"\u5168\u9009",commandName:"selectAll"}},removeFormat:{toolbarButtonData:{icon:"fa fa-eraser",title:"\u53bb\u9664\u6240\u6709\u683c\u5f0f",commandName:"removeFormat"}},undo:{toolbarButtonData:{icon:"fa fa-undo",
title:"\u64a4\u9500",commandName:"undo"}},redo:{toolbarButtonData:{icon:"fa fa-repeat",title:"\u91cd\u505a",commandName:"redo"}}});$.extend(f,{align:{nodeInfo:{attributes:["align"]},toolbarButtonData:{icon:"fa fa-align-center",title:"\u5bf9\u9f50",menu:[{valueArgument:"left",nodeText:'<i class="fa fa-align-left"></i>'},{valueArgument:"center",nodeText:'<i class="fa fa-align-center"></i>'},{valueArgument:"right",nodeText:'<i class="fa fa-align-right"></i>'},{valueArgument:"justify",nodeText:'<i class="fa fa-align-justify"></i>'}]},
toolbarButtonCommand:function(a){var b=a.plugins.align.target.find("ul.dropdown-menu");["justifyLeft","justifyCenter","justifyRight","justifyFull"].forEach(function(c,d){b.find("a").eq(d).on("click",function(){a.execCommand(c)})})}},indent:{toolbarButtonData:{icon:"fa fa-indent",title:"\u589e\u52a0\u7f29\u8fdb"},toolbarButtonCommand:function(a){a.plugins.indent.target.on("click",function(){var b=l.parentElement(),c=$(b);$(b).parentsUntil(a.editable).each(function(){c=$(this)});"HTML"!==c.get(0).tagName&&
(b=parseInt(c.css("margin-left")),c.css("margin-left",Math.max(0,b+20)))})}},outdent:{toolbarButtonData:{icon:"fa fa-dedent",title:"\u51cf\u5c11\u7f29\u8fdb"},toolbarButtonCommand:function(a){a.plugins.outdent.target.on("click",function(){var b=l.parentElement(),c=$(b);$(b).parentsUntil(a.editable).each(function(){c=$(this)});"HTML"!==c.get(0).tagName&&(b=parseInt(c.css("margin-left")),c.css("margin-left",Math.max(0,b-20)))})}},orderedList:{nodeInfo:{tags:["OL"]},toolbarButtonData:{icon:"fa fa-list-ol",
title:"\u6570\u5b57\u5217\u8868"},toolbarButtonCommand:function(a){a.plugins.orderedList.target.on("click",function(){$(this).toggleClass("active");$(this).parent().siblings().find('button[data-command-name="unordered-list"]').removeClass("active");a.execCommand("insertOrderedList",!1)})}},unorderedList:{nodeInfo:{tags:["UL"]},toolbarButtonData:{icon:"fa fa-list-ul",title:"\u7b26\u53f7\u5217\u8868"},toolbarButtonCommand:function(a){a.plugins.unorderedList.target.on("click",function(){$(this).toggleClass("active");
$(this).parent().siblings().find('button[data-command-name="ordered-list"]').removeClass("active");a.execCommand("insertUnorderedList",!1)})}},quote:{nodeInfo:{tags:["BLOCKQUOTE"]},toolbarButtonData:{icon:"fa fa-quote-left",title:"\u5f15\u7528",commandName:"blockquote"},toolbarButtonCommand:function(a){a.plugins.quote.target.on("click",function(){$(this).hasClass("active")?($(this).removeClass("active"),a.execCommand("outdent",!1)):($(this).addClass("active"),a.execCommand("indent",!1))})}}});$.extend(f,
{fullScreen:{toolbarButtonData:{icon:"fa fa-expand",title:"\u5168\u5c4f\u7f16\u8f91",commandName:"fullScreen"},toolbarButtonCommand:function(a){a.plugins.fullScreen.target.on("click",function(){a.editor.toggleFullScreen()})}},codeView:{toolbarButtonData:{icon:"fa fa-code",title:"\u53ef\u89c6\u5316\u7f16\u8f91",commandName:"codeView"},toolbarButtonCommand:function(a){a.plugins.codeView.target.on("click",function(){a.editor.toggleSource()})}}});f.bold.toolbarButtonCommand=f.italic.toolbarButtonCommand=
f.underline.toolbarButtonCommand=f.strikeThrough.toolbarButtonCommand=function(a,b){var c=a.plugins[b].target;c.on("click",function(){var d=c.find("button");d.toggleClass("active");a.execCommand(d.attr("data-command-name").camelCase())})};f.insertHR.toolbarButtonCommand=f.selectAll.toolbarButtonCommand=f.removeFormat.toolbarButtonCommand=f.undo.toolbarButtonCommand=f.redo.toolbarButtonCommand=function(a,b){var c=a.plugins[b].target;c.on("click",function(){var d=c.find("button");a.execCommand(d.attr("data-command-name").camelCase())})};
f.fontFamily.toolbarButtonCommand=f.fontSize.toolbarButtonCommand=f.formatBlock.toolbarButtonCommand=f.color.toolbarButtonCommand=function(a,b){b=a.plugins[b].target;var c=b.find("button");b.find("ul.dropdown-menu").find("a").each(function(){$(this).on("click",function(){a.execCommand(c.attr("data-command-name").camelCase(),!1,$(this).attr("data-value-argument"))})})};f.bold.userSelectionCommand=f.italic.userSelectionCommand=f.underline.userSelectionCommand=f.strikeThrough.userSelectionCommand=f.orderedList.userSelectionCommand=
f.unorderedList.userSelectionCommand=f.quote.userSelectionCommand=function(a,b,c){a=a.plugins[c];b?a.target.find("button").addClass("active"):a.target.find("button").removeClass("active")};f.fontFamily.userSelectionCommand=f.fontSize.userSelectionCommand=f.color.userSelectionCommand=f.align.userSelectionCommand=function(a,b,c){a.plugins[c].target.find("ul.dropdown-menu li").each(function(){var a=$(this).find("a").attr("data-value-argument");b===a?$(this).addClass("active"):$(this).removeClass("active")})};
$.extend(f,{link:{dialog:!0,nodeInfo:{tags:["A"]},toolbarButtonData:{icon:"fa fa-link",title:"\u8d85\u94fe\u63a5"},toolbarButtonCommand:function(a){a.plugins.link.target.on("click",function(){for(var b=0,c=a.editwrap.find(".plugins-wrap"),d=!0;b<c.length;b++)$(c[b]).is(":visible")&&(d=!1);d&&a.plugins.link.insert()})},userSelectionCommand:function(a,b){b&&a.plugins.link.update(b)},pluginFactoryCommand:function(a){var b=function(){this.init.apply(this,arguments)};b.prototype={init:function(){this.text=
b.defaults.text},setContents:function(){var c=this;this.contents=$('<div class="form-body">\r\n\t\t\t\t\t\t<div class="form-group">\r\n\t\t\t\t\t\t\t<label class="control-label">\u94fe\u63a5\u6587\u5b57</label>\r\n\t\t\t\t\t\t      <input type="text" class="form-control input-sm" value="'+this.text+'">\r\n\t\t\t\t\t\t      <a class="btn-unlink" title="\u79fb\u9664\u94fe\u63a5" href="javascript:;">\r\n\t\t\t\t\t\t\t\t<span class="fa fa-unlink"></span>\r\n\t\t\t\t\t\t\t  </a>\r\n\t\t\t\t\t\t    </div>\r\n\t\t\t\t\t\t    <div class="form-group">\r\n\t\t\t\t\t\t      <label class="control-label">\u94fe\u63a5\u5730\u5740</label>\r\n\t\t\t\t\t\t      <input type="text" class="form-control input-sm" value="http://www.baidu.com">\r\n\t\t\t\t\t\t    </div>\r\n\t\t\t\t\t\t    <div class="form-group">\r\n\t\t\t\t\t\t  \t  <label class="control-label">\u6253\u5f00\u65b9\u5f0f</label>\r\n\t\t\t\t\t\t      <select class="form-control input-sm">\r\n\t\t\t\t\t\t\t      <option value="_blank">\u5728\u5f53\u524d\u7a97\u53e3\u4e2d\u6253\u5f00(_blank)</option>\r\n\t\t\t\t\t\t\t      <option value="_self">\u5728\u65b0\u7a97\u53e3\u4e2d\u6253\u5f00(_self)</option>\r\n\t\t\t\t\t\t      </select>\r\n\t\t\t\t\t\t  </div>\r\n\t\t\t\t\t\t</div>');
this.inputText=this.contents.find("input").eq(0);this.inputLink=this.contents.find("input").eq(1);this.select=this.contents.find("select");this.unlink=this.contents.find(".btn-unlink");this.inputText.on("input",function(){c.node.text($(this).val())});this.inputLink.on("input",function(){c.node.attr("href",$(this).val())});this.select.on("change",function(){c.node.attr("target",$(this).val())});this.unlink.on("click",function(){l.selectNode(c.node.get(0));a.execCommand("unlink",!1);c.dialog.hide()})},
dialogBox:function(){var c=this;this.dialog=m.dialog({id:b.defaults.id,width:300,height:106,fullHeight:!1,skinClassName:"plugins-wrap",appendTo:a.editable,appendMode:"after",clickBoxClose:a.editable,closeType:"hide",reload:!0,hideToolbar:!0,show:!0,onShown:function(){c.repos(0,4);c.node.addClass("selected");c.removeFn=function(){var a=c.node;return function(){a.removeClass("selected")}}()},onHiden:function(){c.removeFn.call(c)}});this.dialogShow()},dialogShow:function(){this.setContents();this.defaultValue();
this.dialog.show({contents:this.contents})},defaultValue:function(){this.inputText.val(this.node.text());this.inputLink.val(this.node.attr("href"));this.select.val(this.node.attr("target"))},insert:function(){var c=l.parentElement(!0);"A"===c.tagName?this.update($(c)):(c="plugins-link-"+r(),(this.text=l.htmlText())?a.execCommand("createLink",!1,c):(this.text=b.defaults.text,a.pasteHTML('<a href="'+c+'">'+this.text+"</a>")),this.node=a.editable.find('a[href="'+c+'"]'),this.node.length&&(this.node.attr({href:"http://www.baidu.com",
target:"_blank"}),this.dialogBox()))},update:function(a){this.node=a;this.node.length&&this.dialogBox()}};b.defaults={id:r(),text:"\u94fe\u63a5\u6587\u5b57"};return b}}});$.extend(f,{image:{dialog:!0,nodeInfo:{tags:["IMG"]},toolbarButtonData:function(a){var b={icon:"fa fa-picture-o",title:"\u56fe\u7247"},c={upload:"\u4e0a\u4f20\u56fe\u7247",external:"\u5916\u94fe\u56fe\u7247"};$.isArray(a.opts.imageButton)?(b.menu=[],a.opts.imageButton.forEach(function(a){b.menu.push({valueArgument:a,nodeText:c[a]||
""})})):b.commandName=a.opts.upload?"upload":"external";return b},toolbarButtonCommand:function(a){var b=a.plugins.image.target,c=b.find("ul.dropdown-menu");if(c.length)c.find("a").each(function(){$(this).on("click",function(){var d=a.plugins.image[$(this).attr("data-value-argument")];d&&d.call(a.plugins.image)})});else b.on("click",function(){var d=b.find("button");(d=a.plugins.image[d.attr("data-command-name").camelCase()])&&d.call(a.plugins.image)})},userSelectionCommand:function(a,b){b&&a.plugins.image.update(b)},
pluginFactoryCommand:function(a){var b=function(){this.init.apply(this,arguments)};b.prototype={init:function(){},setContents:function(){var c=this;this.contents=$('<div class="form-body">\r\n\t\t\t\t\t\t<div class="form-group">\r\n\t\t\t\t\t\t\t<label class="control-label">\u56fe\u7247\u5730\u5740</label>\r\n\t\t\t\t\t\t\t<input type="text" class="form-control input-sm" value="'+a.opts.defaultImage+'">\r\n\t\t\t\t\t\t\t<a class="btn-upload'+(a.opts.upload?"":" hide")+'" title="\u4e0a\u4f20\u56fe\u7247" href="javascript:;">\r\n\t\t\t\t\t\t\t\t<span class="fa fa-upload"></span>\r\n\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class="form-group">\r\n\t\t\t\t\t\t    <label class="control-label">\u56fe\u7247\u63cf\u8ff0</label>\r\n\t\t\t\t\t\t    <input type="text" class="form-control input-sm" value="Image">\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class="form-group">\r\n\t\t\t\t\t\t    <label class="control-label">\u56fe\u7247\u5c3a\u5bf8</label>\r\n\t\t\t\t\t\t\t<input class="form-control input-sm image-size" type="text" value="" maxlength="4" onclick="select()">\r\n\t\t\t\t\t\t\t<span class="times">\u00d7</span>\r\n\t\t\t\t\t\t\t<input class="form-control input-sm image-size" type="text" value="" maxlength="4" onclick="select()">\r\n\t\t\t\t\t\t\t<a class="btn-trash" title="\u5220\u9664\u56fe\u7247" href="javascript:;">\r\n\t\t\t\t\t\t\t\t<span class="fa fa-trash-o"></span>\r\n\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>');
this.inputUrl=this.contents.find('input[type="text"]').eq(0);this.inputDesc=this.contents.find('input[type="text"]').eq(1);this.inputSizeW=this.contents.find("input.image-size").eq(0);this.inputSizeH=this.contents.find("input.image-size").eq(1);this.inputFile=this.contents.find('input[type="file"]');this.linkUpload=this.contents.find("a.btn-upload");this.linkDelete=this.contents.find("a.btn-trash");this.inputUrl.on("input",function(){c.node.attr("src",$(this).val())});this.inputDesc.on("input",function(){c.node.attr("alt",
$(this).val())});this.inputSizeW.on("input",function(){""==$(this).val()?c.node.removeAttr("width"):c.node.attr("width",$(this).val());a.target.trigger("valuechanged")});this.inputSizeH.on("input",function(){""==$(this).val()?c.node.removeAttr("height"):c.node.attr("height",$(this).val());a.target.trigger("valuechanged")});this.linkUpload.on("click",function(){c.uploadAjax(1)});this.linkDelete.on("click",function(){c.node.remove();c.dialog.hide()})},dialogBox:function(){var c=this;this.dialog=m.dialog({id:b.defaults.id,
width:300,height:106,fullHeight:!1,skinClassName:"plugins-wrap",appendTo:a.editable,appendMode:"after",clickBoxClose:a.editable,closeType:"hide",reload:!0,hideToolbar:!0,show:!0,onShown:function(){c.defaultValue();c.repos();c.node.addClass("selected");c.removeFn=function(){var a=c.node;return function(){a.removeClass("selected")}}()},onHiden:function(){c.removeFn.call(c)}});this.dialogShow()},dialogShow:function(){this.setContents();this.dialog.show({contents:this.contents})},defaultValue:function(){this.inputUrl.val(this.node.attr("src"));
this.inputDesc.val(this.node.attr("alt"));this.inputSizeW.val(this.node.attr("width"));this.inputSizeH.val(this.node.attr("height"))},external:function(){this.createImage(a.opts.defaultImage);this.node.length&&(this.node.addClass("selected").removeAttr("id"),v(this.node.get(0)),this.dialogBox())},update:function(a){this.node=a;this.node.length&&this.dialogBox()},createImage:function(c){var d="plugins-image-"+r();a.pasteHTML('<img id="'+d+'" src="'+c+'" alt="Image">');this.node=a.editable.find("#"+
d)},upload:function(){a.selectInEditor()&&this.uploadAjax(0)},uploadAjax:function(c){var d=this,b=[],g=$('<input type="file"'+(0===c?' multiple="multiple"':"")+' accept="image/*">');g.on("change",function(){for(var e=new FormData,g=0===c?$(this)[0].files:[$(this)[0].files[0]],f=0;f<g.length&&!(a.opts.imageUpload.connectionCount<f+1);f++)e.append(a.opts.imageUpload.fileKey+f,g[f]),0===c&&(d.createImage(a.opts.loadingImage),d.node.length&&(d.node.wrap("<p></p>"),d.node.removeAttr("id"),v(d.node.get(0)))),
b.unshift(d.node);for(n in a.opts.imageUpload.params)e.append(n,a.opts.imageUpload.params[n]);$.ajax({url:a.opts.imageUpload.url,type:"GET",data:e,dataType:"json",cache:!1,contentType:!1,processData:!1,success:function(a){b.forEach(function(d,b){d.attr("src",a.img[b].imgUrl)})}})});g.get(0).click()}};b.defaults={id:r()};return b}}});$.extend(f,{table:{dialog:!0,nodeInfo:{tags:["TH","TD"]},toolbarButtonData:function(a){a=0;for(var b=[];5>a;a++)for(var c=0;6>c;c++)b.push({valueArgument:a+","+c,nodeText:"<span></span>"});
return{icon:"fa fa-table",title:"\u8868\u683c",menu:b}},toolbarButtonCommand:function(a){var b=a.plugins.table,c=b.target.find("ul.dropdown-menu");c.on("mouseover","a",function(){var a=$(this).attr("data-value-argument");a=a.split(",");c.find("a").each(function(){var d=$(this).attr("data-value-argument").split(",");d[0]<=a[0]&&d[1]<=a[1]?$(this).parent().addClass("active"):$(this).parent().removeClass("active")})});c.on("mouseout",function(){$(this).find("a").parent().removeClass("active")});c.on("click",
"a",function(a){a=$(a.target).attr("data-value-argument");b.insert(a.split(","))})},userSelectionCommand:function(a,b){b&&a.plugins.table.update(b)},pluginFactoryCommand:function(a){var b={tableHeader:{nodeInfo:{tags:["TH"]},toolbarButtonData:{icon:"fa fa-header",title:"\u8868\u5934"},toolbarButtonCommand:function(a,b,c){var d=a.plugins[b].target;d.on("click",function(){var a=d.find("button"),b=c.node;a.toggleClass("active");a=c.getTable(b);var e=a.find("thead");e.length?e.remove():(b=c.getColumnCount(b),
b=c.setTh(b),e=$("<thead><tr>"+b+"</tr></thead>"),a.find("tbody").before(e))})},userSelectionCommand:function(a,b,c){a=a.plugins[c];b?a.target.find("button").addClass("active"):a.target.find("button").removeClass("active")}},removeTable:{toolbarButtonData:{icon:"fa fa-trash-o",title:"\u5220\u9664\u8868\u683c"},toolbarButtonCommand:function(a,b,c){var d=a.plugins[b].target;d.on("click",function(){d.find("button");var a=c.dialog;c.getTable(c.node).remove();a.hide()})}},row:{toolbarButtonData:{icon:"fa fa-reorder",
title:"\u884c",menu:[{valueArgument:"insertRowAbove",nodeText:"\u4e0a\u9762\u63d2\u5165\u884c"},{valueArgument:"insertRowBelow",nodeText:"\u4e0b\u9762\u63d2\u5165\u884c"},{valueArgument:"deleteRow",nodeText:"\u5220\u9664\u884c"}]},toolbarButtonCommand:function(a,b,c){a.plugins[b].target.find("ul.dropdown-menu").find("a").each(function(){$(this).on("click",function(){var a=c.node,b=c.dialog,d=$(this).attr("data-value-argument");if("deleteRow"===d)a.closest("tr").remove(),b.hide();else c[d](a)})})}},
column:{toolbarButtonData:{icon:"fa fa-reorder fa-rotate-90",title:"\u5217",menu:[{valueArgument:"insertColumnBefore",nodeText:"\u5de6\u8fb9\u63d2\u5165\u5217"},{valueArgument:"insertColumnAfter",nodeText:"\u53f3\u8fb9\u63d2\u5165\u5217"},{valueArgument:"deleteColumn",nodeText:"\u5220\u9664\u5217"}]},toolbarButtonCommand:function(a,b,c){a.plugins[b].target.find("ul.dropdown-menu").find("a").each(function(){$(this).on("click",function(){var a=c.node,b=c.dialog,d=$(this).attr("data-value-argument");
if("deleteColumn"===d){var e=a.index();a.closest("tr").siblings().each(function(){$(this).find("td").eq(e).remove()});a.remove();b.hide()}else c[d](a)})})}},tableStyle:{toolbarButtonData:{icon:"fa fa-leaf",title:"\u8868\u683c\u6837\u5f0f",menu:[{valueArgument:"dashedBorders",nodeText:"\u865a\u7ebf\u8fb9\u6846"},{valueArgument:"alternateRows",nodeText:"\u9694\u884c\u53d8\u8272"}]},toolbarButtonCommand:function(a,b,c){a.plugins[b].target.find("ul.dropdown-menu").find("a").each(function(){$(this).on("click",
function(){var a=c.node,b=$(this).attr("data-value-argument");a=c.getTable(a);"dashedBorders"===b?a.hasClass("dashed-borders")?(a.removeClass("dashed-borders"),a.find("td").css("border-style","")):(a.addClass("dashed-borders"),a.find("td").css("border-style","dashed")):"alternateRows"===b&&(a.hasClass("alternate-rows")?(a.removeClass("alternate-rows"),a.find("tr").filter(":even").find("td").css("background-color","")):(a.addClass("alternate-rows"),a.find("tr").filter(":even").find("td").css("background-color",
"#f5f5f5")))})})}},cell:{toolbarButtonData:{icon:"fa fa-square-o",title:"\u5355\u5143\u683c",menu:[{valueArgument:"mergeCells",nodeText:"\u5408\u5e76\u5217"},{valueArgument:"verticalSplit",nodeText:"\u6c34\u5e73\u62c6\u5206"},{valueArgument:"horizontalSplit",nodeText:"\u5782\u76f4\u62c6\u5206"}]},toolbarButtonCommand:function(a,b,c){a.plugins[b].target.find("ul.dropdown-menu").find("a").each(function(){$(this).on("click",function(){var a=c.node;$(this).attr("data-value-argument");c.getTable(a)})})}},
color:{toolbarButtonData:{icon:"fa fa-tint",title:"\u989c\u8272",menu:[{valueArgument:"#e33737",nodeText:'<span style="background:#e33737"></span>'},{valueArgument:"#e28b41",nodeText:'<span style="background:#e28b41"></span>'},{valueArgument:"#c8a732",nodeText:'<span style="background:#c8a732"></span>'},{valueArgument:"#209361",nodeText:'<span style="background:#209361"></span>'},{valueArgument:"#418caf",nodeText:'<span style="background:#418caf"></span>'},{valueArgument:"#aa8773",nodeText:'<span style="background:#aa8773"></span>'},
{valueArgument:"#999999",nodeText:'<span style="background:#999999"></span>'},{valueArgument:"#000000",nodeText:'<span style="background:#000000"></span>'}]},toolbarButtonCommand:function(a,b,c){a.plugins[b].target.find("ul.dropdown-menu").find("a").each(function(){$(this).on("click",function(){var a=c.node,b=$(this).attr("data-value-argument");a.attr("bgcolor",b)})})}},verticalAlign:{toolbarButtonData:{icon:"fa fa-arrows-v",title:"\u5782\u76f4\u5bf9\u9f50",menu:[{valueArgument:"top",nodeText:"\u9876\u7aef"},
{valueArgument:"middle",nodeText:"\u5c45\u4e2d"},{valueArgument:"bottom",nodeText:"\u5e95\u90e8"}]},toolbarButtonCommand:function(a,b,c){a.plugins[b].target.find("ul.dropdown-menu").find("a").each(function(){$(this).on("click",function(){var a=c.node,b=$(this).attr("data-value-argument");a.css("vertical-align",b)})})}},horizontalAlign:{toolbarButtonData:{icon:"fa fa-arrows-h",title:"\u6c34\u5e73\u5bf9\u9f50",menu:[{valueArgument:"left",nodeText:"\u5de6\u5bf9\u9f50"},{valueArgument:"center",nodeText:"\u5c45\u4e2d\u5bf9\u9f50"},
{valueArgument:"right",nodeText:"\u53f3\u5bf9\u9f50"}]},toolbarButtonCommand:function(a,b,c){a.plugins[b].target.find("ul.dropdown-menu").find("a").each(function(){$(this).on("click",function(){var a=c.node,b=$(this).attr("data-value-argument");a.css("text-align",b)})})}},cellStyle:{toolbarButtonData:{icon:"fa fa-magic",title:"\u5355\u5143\u683c\u6837\u5f0f",menu:[{nodeText:"\u589e\u5f3a\u4eae\u5ea6"},{nodeText:"\u589e\u5f3a\u5bbd\u5ea6"}]},toolbarButtonCommand:function(a,b,c){a=a.plugins[b].target.find("ul.dropdown-menu");
a.find("a").eq(0).on("click",function(){var a=c.node;a.hasClass("highlighted")?(a.removeClass("highlighted"),a.css("border-color","")):(a.addClass("highlighted"),a.css("border-color","red"))});a.find("a").eq(1).on("click",function(){var a=c.node;a.hasClass("thick")?(a.removeClass("thick"),a.css("border-width","")):(a.addClass("thick"),a.css("border-width","2px"))})}}},c=function(){this.init.apply(this,arguments)};c.prototype={init:function(){var c=this,e=$.extend({},a,{opts:{toolbarButtons:"tableHeader removeTable row column tableStyle cell color verticalAlign horizontalAlign cellStyle".split(" "),
plugins:b},plugins:{},nodeInfo:{tags:{},attributes:{}}});e.editable.on("click",function(a){e.userSelectionCommand(a.target)}).on("keyup",function(a){37!=a.keyCode&&38!=a.keyCode&&39!=a.keyCode&&40!=a.keyCode&&13!=a.keyCode||e.userSelectionCommand()});e.editor.on("initialized",function(){$.extend(e,{editwrap:a.editwrap});g.addEscBehaviour()});var g=this.toolbar=m.toolbar(e);e.opts.toolbarButtons.forEach(function(a){g.addButton(a);g.injectCommand(a,c)})},insert:function(b){var c=b[0];b=b[1];for(var d=
"plugins-table-"+r(),f='<table id="'+d+'" border="1" width="100%"><tbody>',h=0;h<=c;h++){f+="<tr>";for(var l=0;l<=b;l++)f+="<td>&nbsp;</td>";f+="</tr>"}a.pasteHTML(f+"</tbody></table>");this.node=a.editable.find("#"+d);this.node.length&&(this.node.prev().length||this.node.before($("<p><br></p>")),this.node.next().length||this.node.after($("<p><br></p>")),this.node.removeAttr("id"),v(this.node.get(0)),this.dialogBox())},update:function(a){this.node=a;this.node.length&&(this.node.addClass("selected"),
this.dialogShow(),this.repos())},dialogBox:function(){this.dialog=m.dialog({id:c.defaults.id,width:250,height:"auto",skinClassName:"plugins-wrap",appendTo:a.editable,appendMode:"after",clickBoxClose:a.editable,closeType:"hide",hideContent:!0,show:!0,onShown:function(){},onHiden:function(){}});this.toolbar.buttons.forEach(function(a){this.dialog.addButton(a)},this)},dialogShow:function(){this.dialog.show()},getTable:function(){return this.node.closest("table")},getColumnCount:function(){var a=0;this.getTable().find("tr").each(function(){a=
Math.max(a,$(this).find("th").length);a=Math.max(a,$(this).find("td").length)});return a},isThead:function(a){a=a.parentsUntil("table").toArray();for(var b=0,c;c=a[b++];)if("THEAD"===c.tagName)return!0},setTh:function(a){for(var b="",c=0;c<a;c++)b+="<th><br></th>";return b},setTd:function(a){for(var b="",c=0;c<a;c++)b+="<td><br></td>";return b},insertRowAbove:function(a){var b=this.getColumnCount(a);b=this.setTd(b);b=$("<tr>"+b+"</tr>");this.isThead(a)||a.closest("tr").before(b)},insertRowBelow:function(a){var b=
this.getColumnCount(a);b=this.setTd(b);b=$("<tr>"+b+"</tr>");this.isThead(a)?this.getTable(a).find("tbody").prepend(b):a.closest("tr").after(b)},insertColumnBefore:function(a){var b=a.index();a.closest("tr").siblings().each(function(){$(this).find("td").eq(b).before($("<td><br></td>"))});a.before($("<td><br></td>"))},insertColumnAfter:function(a){var b=a.index();a.closest("tr").siblings().each(function(){$(this).find("td").eq(b).after($("<td><br></td>"))});a.after($("<td><br></td>"))}};c.defaults=
{id:r()};return c}}})})(this);